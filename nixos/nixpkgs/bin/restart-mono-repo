#!/usr/bin/env bash

# REPO_PATH=$HOME/projects/genially/mono
#
# printf "Restarting Genially mono project ..."
#
# start_time="$(date -u +%s)"
#
# cd $REPO_PATH
# printf "\nCleaning modules ..."
# yarn clean:modules
#
# printf "\nInstalling dependencies ..."
# yarn
#
# printf "\nBuildin project ..."
# gsh cli builder --all
#
# end_time="$(date -u +%s)"
#
# elapsed="$(($end_time - $start_time))"
# h=$(($elapsed / 3600))
# m=$((($elapsed % 3600) / 60))
# s=$(($elapsed % 60))
#
# printf "Genially mono project restarted \nTotal time (hours:minutes:seconds): %02d:%02d:%02d \n" $h $m $s

REPO_PATH=$HOME/projects/genially/mono

echo "Restarting Genially mono project ..." | lolcat

start_time="$(date -u +%s)"

confirm() {
	read -r -p "$1? [y/N] " response

	if [[ "$response" =~ ^y$ ]]; then
		echo $3 | lolcat
		$2
	fi
}

cd $REPO_PATH

confirm "Clean current modules" "yarn clean:modules" "Cleaning current modules ..."

confirm "Install dependencies" "yarn" "Installing dependencies ..."

confirm "Build dependencies" "yarn b:deps" "Building project with turborepo ..."

end_time="$(date -u +%s)"

elapsed="$(($end_time - $start_time))"
h=$(($elapsed / 3600))
m=$((($elapsed % 3600) / 60))
s=$(($elapsed % 60))

printf "Genially mono project restarted \nTotal time (hours:minutes:seconds): %02d:%02d:%02d \n" $h $m $s
