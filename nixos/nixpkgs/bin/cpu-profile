#!/usr/bin/env bash

check_dependences() {
	if ! command -v ryzenadj &>/dev/null 2>&1; then
		printf >&2 "${RED}Error: ryzenadj could not be found\n"
		exit 1
	fi
}

get_cpu_profile_values() {
  STAPM_LIMIT=$(sudo ryzenadj -i | grep "STAPM LIMIT" | awk '{print $5}')
  PPT_LIMIT_FAST=$(sudo ryzenadj -i | grep "PPT LIMIT FAST" | awk '{print $6}')
  PPT_LIMIT_SLOW=$(sudo ryzenadj -i | grep "PPT LIMIT SLOW" | awk '{print $6}')
}


show_current_cpu_profile() {
  get_cpu_profile_values

  if [[ $STAPM_LIMIT == "10.000" && $PPT_LIMIT_SLOW = "10.000" && $PPT_LIMIT_FAST = "10.000" ]]; then
    echo "%{B#21252b}%{F#98c379}%{B- F-}"
  elif [[ $STAPM_LIMIT == "15.000" && $PPT_LIMIT_SLOW = "15.000" && $PPT_LIMIT_FAST = "25.000" ]]; then
    echo "%{B#21252b}%{F#61afef}%{B- F-}"
  elif [[ $STAPM_LIMIT == "80.000" && $PPT_LIMIT_SLOW = "70.000" && $PPT_LIMIT_FAST = "100.000" ]]; then
    echo "%{B#21252b}%{F#e06c75}%{B- F-}"
  else
    echo "%{B#21252b}%{F#e0af68}%{T3}%{B- F-}"
  fi
}

show_current_cpu_profile
